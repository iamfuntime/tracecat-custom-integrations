type: action
definition:
  title: Update Elastic Security Alert Status
  description: Update the workflow status of Elastic Security detection alerts
  display_group: Elastic Security
  namespace: tools.elastic_security
  name: update_alert_status
  doc_url: https://www.elastic.co/guide/en/security/current/detections-api-update-status.html

  secrets:
    - name: elastic_security
      keys:
        - ELASTIC_API_KEY

  expects:
    alert_ids:
      type: list[any]
      description: List of alert IDs to update

    status:
      type: str
      description: New workflow status (open, acknowledged, closed, in-progress)
      default: acknowledged

    base_url:
      type: str | None
      description: Kibana endpoint URL (e.g. https://localhost:5601)
      default: null

    comment:
      type: str | None
      description: Optional comment to add when updating status
      default: null

    verify_ssl:
      type: bool
      description: Whether to verify SSL certificates
      default: true

  steps:
    - ref: update_status
      action: core.http_request
      args:
        url: ${{ inputs.base_url || VARS.elastic_security.base_url }}/api/detection_engine/signals/status
        method: POST
        headers:
          kbn-xsrf: "true"
          Authorization: ApiKey ${{ SECRETS.elastic_security.ELASTIC_API_KEY }}
          Content-Type: application/json
        payload:
          signal_ids: ${{ inputs.alert_ids }}
          status: ${{ inputs.status }}
        verify_ssl: ${{ inputs.verify_ssl }}

  returns: ${{ steps.update_status.result }}
